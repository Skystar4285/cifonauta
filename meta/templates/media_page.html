{% extends 'base.html' %}
{% load i18n %}
{% block title %}{{ media.title }} | {{ block.super }}{% endblock %}
{% block meta-keywords %}{% show_set tags '' '' ', ' '' %}, {% show_set authors '' '' ', ' '' %}, {% show_set taxa '' '' ', ' '' %}, {% show_set sources '' '' ', ' '' %}, {{ media.sublocation.name }}, {{ media.city.name }}, {{ media.state.name }}, {{ media.country.slug }}{% endblock %}
{% block meta-description %}{% if media.caption %}{{ media.caption }}{% else %}{{ media.title }}{% endif %} {% trans 'Por' %} {% show_set authors '' '' ', ' '' %}.{% endblock %}
{% block meta-author %}{% show_set authors '' '' ', ' '' %}{% endblock %}

{% block extra-head %}

<meta property="og:title" content="{{ media.title }}" />
<meta property="og:url" content="{{ request.build_absolute_uri }}" />
<meta property="og:image" content="http://{{ request.get_host }}{{ MEDIA_URL }}{{ media.thumb_filepath }}" />
<meta property="og:description" content="{% if media.caption %}{{ media.caption }}{% else %}{{ media.title }}{% endif %}; {% show_set authors '' '' ', ' '' %}" />
<meta property="og:site_name" content="{% trans 'Cifonauta: Banco de Imagens de Biologia Marinha' %}" />

{% if media.datatype == 'video' %}
<meta property="og:video" content="http://{{ request.get_host }}{{ MEDIA_URL }}{{ media.mp4_filepath }}" />
<meta property="og:video:height" content="{{ height }}" />
<meta property="og:video:width" content="512" />
<meta property="og:video:type" content="application/x-shockwave-flash" />
<meta property="og:type" content="cifonauta:video" />
{% else %}
<meta property="og:type" content="cifonauta:photo" />
{% endif %}

<script type="text/javascript">
// JavaScript code goes here.
$(document).ready(function(){
        // Collapsible comments
        $(".show-comment").click(function(){
            $("#comment-box").slideToggle("slow");
            $(this).hide();
            $(".hide-comment").show();
            });
        $(".hide-comment").click(function(){
            $("#comment-box").slideToggle("slow");
            $(this).hide();
            $(".show-comment").show();
            }
        );

        // External DB hovers
        $(".biodb li").hover(
            function () {
                $(this).find(".external").fadeIn(200);
            },
            function () {
                $(this).find(".external").fadeOut(200);
            }
        );

        // Collapsible cite 
        $("#cite-sideinfo").click(function(){
            $("#citation").slideToggle();
            $(this).toggleClass("bg-merge");
            });
});
</script>

<!-- ShareThis -->
<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({
    publisher:'c581e214-c1ef-43a0-9fa6-ce8c0de234df',
    tracking:'google',
    onhover:false,
    });
</script>
{% endblock %}

{% block content %}
{% load comments %}
<section class="span-16">
    {% if media %}
    <article id="single" class="{{ media.datatype }} {% show_set authors 'author-' '' ' ' 'slug' %} {% show_set taxa 'taxon-' '' ' ' 'slug' %} size-{{ media.size.slug }} {% show_set sources 'source-' '' ' ' 'slug' %} sublocation-{{ media.sublocation.slug }} city-{{ media.city.slug }} state-{{ media.state.slug }} country-{{ media.country.slug }} views-{{ media.view_count }}">
        <header class="span-16 last">
            <h1>{{ media.title }}</h1>
        </header>
        {% if media.is_public %}
        {% if tags %}
            <footer class="span-16 last media-tags">
                {% show_set tags '' '' ', ' 'link' %}
            </footer>
        {% endif %}

        <figure class="span-13 {{ media.datatype }} borders">
            {% if media.datatype == 'photo' %}
                {% include 'photo.html' %}
            {% else %}
                {% if media.datatype == 'video' %}
                    {% include 'video.html' %}
                {% endif %}
            {% endif %}
            {% if media.caption %}
                <figcation class="span-13 last">{{ media.caption }}</figcaption>
                <div class="span-13 last align-right" id="author">{% show_set authors '' '' ', ' '' %}</div>
            {% else %}
            <div class="span-13 last" id="author">
                {% show_set authors '' '' ', ' '' %}
            </div>
            {% endif %}
        </figure>

        <div class="span-2 last border-top border-right border-bottom sideinfo" id="media-sideinfo">
            <div class="border-bottom" id="views">
                {{ media.view_count }} {% trans 'visita' %}{{ media.view_count|pluralize }}
            </div>
            {% if taxa %}
                {% include 'biodb.html' %}
            {% endif %}

            {% if media.size.name %}
            {% spaceless %}
            <div class="span-2 last border-top" id="size">
                <div class="size-{{ media.size.slug }}" id="size-string" title="Tamanho do organismo: {{ media.size }}">
                    {{ media.size }}
                </div>
                <div class="size-legend">
                    <div class="size-01-mm" title="<0,1 mm"></div>
                    <div class="size-01-10-mm" title="0,1 - 1,0 mm"></div>
                    <div class="size-10-10-mm" title="1,0 - 10 mm"></div>
                    <div class="size-10-100-mm" title="10 - 100 mm"></div>
                    <div class="size-100-mm" title=">100 mm"></div>
                </div>
            </div>
            {% endspaceless %}
            {% endif %}

        </div>

        <div class="span-13 last borders" id="meta">
            <div id="citation" class="span-13">
                <div>
                    {% show_set authors '' '.' ', ' '' %} <strong>{{ media.title }}</strong>. {% trans 'Imagem' %} {% trans 'acessada no banco de imagens <em>Cifonauta</em> em' %} {% now "F j, Y" %}. Link: <a href="{{ media.get_absolute_url }}">http://{{ request.META.HTTP_HOST }}{{ media.get_absolute_url }}</a>
                </div>
            </div>
            <div class="span-7 taxonomy">

                {% if taxa %}
                <strong>{% blocktrans count taxa.count as counter %}Táxon{% plural %}Táxons{% endblocktrans %}:</strong> <span id="taxon">{% show_set taxa '' '' ', ' '' %}</span>
                <br>
                {% endif %}

                {% if sources %}
                <strong>{% blocktrans count sources.count as counter %}Especialista{% plural %}Especialistas{% endblocktrans %}:</strong> <span id="source">{% show_set sources '' '' ', ' '' %}</span>
                {% endif %}
            </div>

            <div class="span-6 last location">
                {% if media.date and media.date|date:"Y" > "1910" %} 
                <strong>{% trans 'Data' %}: </strong> <span id="date"><datetime>{{ media.date|date:"DATETIME_FORMAT" }}</datetime></span>
                <br>
                {% endif %}
                {% if media.sublocation.name or media.city.name or media.state.name or media.country.name %}
                <strong>{% trans 'Local' %}:</strong> 
                    {% if media.sublocation.name %}<span id="sublocation">{{ media.sublocation }},</span>{% endif %}
                    {% if media.city.name %}<span id="city">{{ media.city }},</span>{% endif %}
                    {% if media.state.name %}<span id="state">{{ media.state }},</span>{% endif %}
                    {% if media.country.name %}<span id="country">{{ media.country }}</span>{% endif %}
                <br>
                {% endif %}

                {% if media.geolocation %}
                <strong>{% trans 'Geolocalização' %}:</strong> <a href="http://maps.google.com/maps?q={{ media.latitude }},{{ media.longitude }}" title="{{ media.geolocation }} no Google Maps">{{ media.geolocation }}</a>
                {% endif %}
            </div>
        </div>
        <div class="span-2 last border-top border-right border-bottom sideinfo" id="cite-sideinfo">
            {% trans 'como citar' %}
        </div>

        {% if media.notes %}
        <div id="notes" class="span-16 last">
            <h2>{% trans 'Notas' %}</h2>
            {{ media.notes }}
            <hr>
        </div>
        {% endif %}

        {% show_related media form related %}

        {% if taxa %}
        {% for taxon in taxa %}
        <div class="span-16 last quiet" id="breadcrumbs">
            <h2>{% trans 'Classificação' %}</h2>
            {% taxon_paths taxon %}
        </div>
        {% endfor %}
        {% endif %}

        {% if references %}
        <div class="span-16 last" id="references">
            <h2>{% trans 'Referências bibliográficas' %}</h2>
            {% for ref in references %}
            <div class="citation">
            {% autoescape off %}{{ ref.citation }}{% endautoescape %}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        {% get_comment_list for media as media_comments %}
        <div id="comments" class="span-16 last">
            {% get_comment_count for media as comment_count %}
            <div class="span-16 last">
                <h2 class="show-comment">{% trans 'Mostrar comentários' %} ({{ comment_count }})</h2>
                <h2 class="hide-comment">{% trans 'Esconder comentários' %} ({{ comment_count }})</h2>
            </div>
            <div id="comment-box">
                {% if media_comments %}
                    <ul id="comment-list">
                    {% for comment in media_comments %}
                    <li>
                        <div id="user-name">
                            <a href="{{ comment.user_url }}">{{ comment.user_name }}</a> | <a href="{% get_comment_permalink comment %}" title="permalink">{{ comment.submit_date|date:"DATETIME_FORMAT" }}</a>
                        </div>
                        <div id="comment-itself">
                            {{ comment.comment }}
                        </div>
                    </li>
                    {% endfor %}
                    </ul>
                {% endif %}
                {% render_comment_form for media %}
            </div>
        </div>

        {% else %}
        <div class="private span-16 last">{% trans 'Esta imagem não está disponível.' %}</div>
        {% endif %}
    </article>
    {% else %}
    <div class="nomatch span-16 last">{% trans 'Nenhuma imagem encontrada.' %}</div>
    {% endif %}
</section>
{% endblock %}
{% block sidebar %}
<aside class="main span-8 last">

{% comment %}Plugins sociais{% endcomment %}
<div class="align-center borders block shadow">
    {% include 'social.html' %}
</div>

{% comment %}Hierarquia taxonômica{% endcomment %}
<div class="borders block shadow">
    {% show_tree %}
</div>

{% comment %}Admin{% endcomment %}
{% if user.is_authenticated %}
<div class="borders block shadow" id="admin-controls">
    <h2>Editar (admin)</h2>
    <ul>
        <li>
            {% if media.datatype == 'photo' %}
                Tipo: <a href="/admin/meta/image/{{ media.id }}/"><strong>FOTO</strong></a>
            {% else %}
                {% if media.datatype == 'video' %}
                    Tipo: <a href="/admin/meta/video/{{ media.id }}/"><strong>VÍDEO</strong></a>
                {% endif %}
            {% endif %}
        </li>
        {% if tags %}
        <li>Marcador(es)</li>
        <ul>
            {% for tag in tags %}
            <li><a href="/admin/meta/tag/{{ tag.id }}/">{{ tag.name }}</a></li>
            {% endfor %}
        </ul>
        {% endif %}
        {% if authors %}
        <li>Autor(es)</li>
        <ul>
            {% for author in authors %}
            <li><a href="/admin/meta/author/{{ author.id }}/">{{ author.name }}</a></li>
            {% endfor %}
        </ul>
        {% endif %}
        {% if taxa %}
        <li>Táxon(s)</li>
        <ul>
            {% for taxon in taxa %}
            <li><a href="/admin/meta/taxon/{{ taxon.id }}/">{{ taxon.name }}</a></li>
            {% endfor %}
        </ul>
        {% endif %}
        {% if sources %}
        <li>Especialista(s)</li>
        <ul>
            {% for source in sources %}
            <li><a href="/admin/meta/source/{{ source.id }}/">{{ source.name }}</a></li>
            {% endfor %}
        </ul>
        {% endif %}
        {% if media.sublocation %}
        <li>Local: <a href="/admin/meta/sublocation/{{ media.sublocation.id }}/">{{ media.sublocation.name }}</a></li>
        {% endif %}
        {% if media.city %}
        <li>Cidade: <a href="/admin/meta/city/{{ media.city.id }}/">{{ media.city.name }}</a></li>
        {% endif %}
        {% if media.state %}
        <li>Estado: <a href="/admin/meta/state/{{ media.state.id }}/">{{ media.state.name }}</a></li>
        {% endif %}
        {% if media.country %}
        <li>País: <a href="/admin/meta/country/{{ media.country.id }}/">{{ media.country.name }}</a></li>
        {% endif %}
        {% if references %}
        <li>Referência(s)</li>
        <ul>
            {% for ref in references %}
            <li><a href="/admin/meta/references/{{ ref.id }}/">{{ ref.name }}</a></li>
            {% endfor %}
        </ul>
        {% endif %}

    </ul>
</div>
{% endif %}

</aside>
{% endblock %}
