{% extends 'base.html' %}
{% load i18n %}
{% block title %}{% trans 'Buscador' %} | {{ block.super }}{% endblock %}
{% block meta-keywords %}{% for k, v in queries.items %}{% if v %}{% comment %} Checa se o marcador é objeto ou string. {% endcomment %}{% if v|islist or v.0.name %}{% for query in v %}{{ query }}, {% endfor %}{% else %}{{ v }}{% if not forloop.last %}, {% endif %}{% endif %}{% endif %}{% endfor %}{% endblock %}
{% block meta-description %}{% trans 'Buscador do banco de imagens Cifonauta.' %}{% endblock %}
{% block meta-author %}Alvaro E. Migotto, Bruno C. Vellutini{% endblock %}

{% block extra-head %}

<meta property="og:title" content="{% trans 'Buscador' %}" />
<meta property="og:url" content="{{ request.build_absolute_uri }}" />
<meta property="og:type" content="article" />
<meta property="og:description" content="{% trans 'Buscador do banco de imagens Cifonauta.' %}" />
<meta property="og:site_name" content="{% trans 'Cifonauta: Banco de Imagens de Biologia Marinha' %}" />

<!--<script type="text/javascript" src="{{ MEDIA_URL }}js/buscador.js"></script>-->
{% endblock %}
{% block content %}
<section class="span-16">
<form id="search-form" method="get" action=".">
    {{ form.query.label_tag }}<strong>:</strong> {{ form.query }} <input type="submit" value="{% trans 'Encontrar' %}" class="fashion" /> <a id="limpar" href="{% url meta.views.search_page %}">{% trans 'Limpar' %}</a>
</form>
<div id="search-results">
    {% if show_results %}
        {% if queries.type == 'photo' %}
        {% blocktrans %}Mostrando apenas <strong>fotos</strong>.{% endblocktrans %} {% trans 'Exibir' %} <a href="{% build_url 'photo' 'type' queries 'True' 'type=all' %}">{% trans 'fotos e vídeos' %}</a> {% trans 'ou' %} <a href="{% build_url 'photo' 'type' queries 'True' 'type=video' %}">{% trans 'apenas vídeos' %}</a>.
        {% else %}
        {% if queries.type == 'video' %}
        {% blocktrans %}Mostrando apenas <strong>vídeos</strong>.{% endblocktrans %} {% trans 'Exibir' %} <a href="{% build_url 'video' 'type' queries 'True' 'type=all' %}">{% trans 'fotos e vídeos' %}</a> {% trans 'ou' %} <a href="{% build_url 'video' 'type' queries 'True' 'type=photo' %}">{% trans 'apenas fotos' %}</a>.
        {% else %}
        {% blocktrans %}Mostrando <strong>fotos</strong> e <strong>vídeos</strong>.{% endblocktrans %} {% trans 'Exibir' %} <a href="{{ request.path }}?{{ request.META.QUERY_STRING }}&type=photo">{% trans 'apenas fotos' %}</a> {% trans 'ou' %} <a href="{{ request.path }}?{{ request.META.QUERY_STRING }}&type=video">{% trans 'apenas vídeos' %}</a>.
        {% comment %}
        Não é preciso chamar o build_url, apenas acrescentar o tipo da mídia no final do url, já que o padrão é NÃO usar o type=all no url quando outras queries estão presentes. Ele só é usado quando está sozinho (ie, '/search/?type=all').
        {% endcomment %}
        {% endif %}
        {% endif %}
        <hr class="space">
        {% include 'gallery.html' %}
    {% else %}
        <hr class="space">
    {% endif %}
</div>
</section>
{% endblock %}
{% block sidebar %}
<aside class="span-8 last">
{% if show_results %}
<div class="block shadow">
    <form action="{{ request.path }}?{{ request.META.QUERY_STRING }}" method="post">
        {{ n_form.as_p}}
        <input type="submit" value="{% trans 'Atualizar' %}" class="fashion" id="display" />
        {% csrf_token %}
    </form>
</div>
    {% show_info image_list video_list queries %}
{% else %}
<div id="showall">
    <a href="/search/?type=all">{% trans 'ou clique para mostrar tudo' %}</a>
</div>
{% endif %}
</aside>
{% endblock %}
