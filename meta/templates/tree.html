{% load mptt_tags %}

{% block extra-head %}
<link rel="stylesheet" href="/site_media/js/jquery-treeview/jquery.treeview.css" /> 
 
{% comment %}
<script src="/site_media/js/jquery-treeview/lib/jquery.js" type="text/javascript"></script> 
{% endcomment %}
<script src="/site_media/js/jquery-treeview/lib/jquery.cookie.js" type="text/javascript"></script> 
<script src="/site_media/js/jquery-treeview/jquery.treeview.js" type="text/javascript"></script> 
 
{% comment %}
<script type="text/javascript">
    $(function() {
            $("#colaptree").treeview(
                {
                    collapsed: true,
                    animated: "fast",
                    persist: "location"
                }
            );
            //{% if media.taxa %}
            //$(".{{ media.taxa.slug }}-hitarea }}").click();
            //var parentnode = $(".{{ media.taxa.slug }}-hitarea }}");
            //do {
            //$.parentnode.click();
            //var parentnode = parentnode.parent();
            //}
            //while (parentnode);
            //{% endif %}
        })
</script>
{% endcomment %}

<script type="text/javascript">
    $(document).ready(function(){
            $("#colaptree").treeview({
                collapsed: true,
                animated: "fast",
                persist: "location"
                });
            {% if media.taxon_set.all %}
                {% for taxon in media.taxon_set.all %}
                    $(".{{ taxon.slug }}-hitarea").click();
                    {% for ancestor in taxon.get_ancestors %}
                        $(".{{ ancestor.slug }}-hitarea").click();
                    {% endfor %}
                {% endfor %}
            {% endif %}
        });
</script>

{% endblock %}

<h2>Grupos</h2>
{% full_tree_for_model meta.Taxon as taxa %}
<ul class="root tree" id="colaptree">
    {% recursetree taxa %}
    {% comment %}{% if node.rank in main_ranks %}{% endcomment %}
    {% if node.rank %}
    <li class="{{ node.rank|slugify }} {{ node.slug }}">
    <span class="quiet">{{ node.rank }}</span> <a href="{{ node.get_absolute_url }}" title="{{ node.name }}">{{ node|sp_em }}</a>
    {% if not node.is_leaf_node %}
    <ul class="children tree">
        {{ children }}
    </ul>
    {% endif %}
    </li>
    {% endif %}
    {% comment %}{% endif %}{% endcomment %}
    {% endrecursetree %}
</ul>
